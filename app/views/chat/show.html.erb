<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-md p-3 sm:p-6 mb-4 sm:mb-6">
      <div class="flex flex-col sm:flex-row sm:items-center justify-between space-y-3 sm:space-y-0">
        <div class="min-w-0 flex-1">
          <h1 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 truncate break-words">
            <%= @conversation.title %>
          </h1>
          <p class="text-gray-600 text-xs sm:text-sm">
            Created <%= time_ago_in_words(@conversation.created_at) %> ago
          </p>
        </div>
        <%= link_to chat_index_path, 
            class: "bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-3 sm:px-4 rounded-lg transition-colors duration-200 flex-shrink-0 text-center text-sm sm:text-base" do %>
          <svg class="w-4 h-4 sm:w-5 sm:h-5 inline mr-1 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          <span class="hidden sm:inline">Back to Conversations</span>
          <span class="sm:hidden">Back</span>
        <% end %>
      </div>
    </div>

    <!-- Chat Messages -->
    <div class="bg-white rounded-lg shadow-md mb-4 sm:mb-6">
      <div class="p-3 sm:p-6">
        <div id="messages" class="space-y-3 sm:space-y-6 max-h-80 sm:max-h-96 overflow-y-auto">
          <% @messages.each do |message| %>
            <div class="flex <%= message.role == 'user' ? 'justify-end' : 'justify-start' %>">
              <div class="max-w-[85%] sm:max-w-sm lg:max-w-md xl:max-w-lg">
                <div class="<%= message.role == 'user' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-900' %> rounded-lg px-3 sm:px-4 py-2 sm:py-3 shadow-sm">
                  <p class="text-sm break-words"><%= message.content %></p>
                </div>
                
                <% if message.image_url.present? %>
                  <div class="mt-3">
                    <%= link_to download_image_path(image_path: message.image_url), 
                        class: "block" do %>
                      <img src="<%= message.image_url %>" 
                           alt="Generated image" 
                           class="rounded-lg shadow-md max-w-full h-auto cursor-pointer"
                           style="max-height: 250px; min-height: 80px;">
                    <% end %>
                  </div>
                <% end %>
                
                <p class="text-xs text-gray-500 mt-2 <%= message.role == 'user' ? 'text-right' : 'text-left' %>">
                  <%= message.created_at.strftime('%H:%M') %>
                </p>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Message Input -->
    <div class="bg-white rounded-lg shadow-md p-3 sm:p-6">
      <%= form_with url: create_message_path(@conversation), method: :post, local: true, 
          class: "flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4", id: "message-form" do |form| %>
        <div class="flex-1">
          <%= form.text_field :content, 
              placeholder: "Describe the image you want to generate...",
              class: "w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm sm:text-base",
              required: true %>
        </div>
        <%= form.submit "Generate Image", 
            class: "bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-2 sm:py-3 px-4 sm:px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 w-full sm:w-auto text-sm sm:text-base",
            data: { disable_with: "Generating..." } %>
      <% end %>
      
      <div class="mt-3 sm:mt-4 text-xs sm:text-sm text-gray-600">
        <p class="flex items-start sm:items-center">
          <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 mt-0.5 sm:mt-0 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span class="text-xs sm:text-sm">Tip: Be specific and descriptive for better results. Try phrases like "a majestic dragon flying over a medieval castle at sunset"</span>
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  // Auto-scroll to bottom of messages
  const messagesContainer = document.getElementById('messages');
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Clear form after submission
  document.getElementById('message-form').addEventListener('submit', function() {
    setTimeout(() => {
      this.reset();
    }, 100);
  });
</script>
